/*!
* UploadiFive 1.1.2-custom
* Custom script by Saikuro
*/
!function(e){var t={init:function(n){return this.each(function(){var o=e(this);o.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var u=o.data("uploadifive"),r=u.settings=e.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadScript:"uploadifive.php",width:100},n);if(isNaN(r.fileSizeLimit)){var l=1.024*parseInt(r.fileSizeLimit);r.fileSizeLimit.indexOf("KB")>-1?r.fileSizeLimit=1e3*l:r.fileSizeLimit.indexOf("MB")>-1?r.fileSizeLimit=1e6*l:r.fileSizeLimit.indexOf("GB")>-1&&(r.fileSizeLimit=1e9*l)}else r.fileSizeLimit=1024*r.fileSizeLimit;if(u.inputTemplate=e('<input type="file">').css({"font-size":r.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),u.createInput=function(){var i=u.inputTemplate.clone(),n=i.name="input"+u.inputCount++;r.multi&&i.attr("multiple",!0),i.bind("change",function(){u.queue.selected=0,u.queue.replaced=0,u.queue.errors=0,u.queue.queued=0;var i=this.files.length;if(u.queue.selected=i,u.queue.count+i>r.queueSizeLimit&&0!==r.queueSizeLimit)e.inArray("onError",r.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+r.queueSizeLimit+").  Please select fewer files."),"function"==typeof r.onError&&r.onError.call(o,"QUEUE_LIMIT_EXCEEDED");else{for(var l=0;i>l;l++)file=this.files[l],u.addQueueItem(file);u.inputs[n]=this,u.createInput()}r.auto&&t.upload.call(o),"function"==typeof r.onSelect&&r.onSelect.call(o,u.queue)}),u.currentInput&&u.currentInput.hide(),u.button.append(i),u.currentInput=i},u.destroyInput=function(t){e(u.inputs[t]).remove(),delete u.inputs[t],u.inputCount--},u.drop=function(i){u.queue.selected=0,u.queue.replaced=0,u.queue.errors=0,u.queue.queued=0;var n=i.dataTransfer,l=n.name="input"+u.inputCount++,a=n.files.length;if(u.queue.selected=a,u.queue.count+a>r.queueSizeLimit&&0!==r.queueSizeLimit)e.inArray("onError",r.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+r.queueSizeLimit+").  Please select fewer files."),"function"==typeof r.onError&&r.onError.call(o,"QUEUE_LIMIT_EXCEEDED");else{for(var s=0;a>s;s++)file=n.files[s],u.addQueueItem(file);u.inputs[l]=n}r.auto&&t.upload.call(o),"function"==typeof r.onDrop&&r.onDrop.call(o,n.files,n.files.length),i.preventDefault(),i.stopPropagation()},u.fileExistsInQueue=function(e){for(var t in u.inputs){input=u.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)if(existingFile=input.files[i],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},u.removeExistingFile=function(e){for(var i in u.inputs){input=u.inputs[i],limit=input.files.length;for(var n=0;n<limit;n++)existingFile=input.files[n],existingFile.name!=e.name||existingFile.complete||(u.queue.replaced++,t.cancel.call(o,existingFile,!0))}},u.queueItem=e(0==r.itemTemplate?'<div class="uploadifive-queue-item">                        <a class="close" href="#">X</a>                        <div><span class="filename"></span><span class="fileinfo"></span></div>                        <div class="progress">                            <div class="progress-bar"></div>                        </div>                    </div>':r.itemTemplate),u.addQueueItem=function(i){if(e.inArray("onAddQueueItem",r.overrideEvents)<0){u.removeExistingFile(i),i.queueItem=u.queueItem.clone(),i.queueItem.attr("id",r.id+"-file-"+u.fileID++),i.queueItem.find(".close").bind("click",function(){return t.cancel.call(o,i),!1});var n=i.name;n.length>r.truncateLength&&0!=r.truncateLength&&(n=n.substring(0,r.truncateLength)+"..."),i.queueItem.find(".filename").html(n),i.queueItem.data("file",i),u.queueEl.append(i.queueItem)}if("function"==typeof r.onAddQueueItem&&r.onAddQueueItem.call(o,i),r.fileType)if(e.isArray(r.fileType)){for(var l=!1,a=0;a<r.fileType.length;a++)i.type.indexOf(r.fileType[a])>-1&&(l=!0);l||u.error("FORBIDDEN_FILE_TYPE",i)}else i.type.indexOf(r.fileType)<0&&u.error("FORBIDDEN_FILE_TYPE",i);i.size>r.fileSizeLimit&&0!=r.fileSizeLimit?u.error("FILE_SIZE_LIMIT_EXCEEDED",i):(u.queue.queued++,u.queue.count++)},u.removeQueueItem=function(t,i,n){n||(n=0);var o=i?0:500;t.queueItem&&(" - Completed"!=t.queueItem.find(".fileinfo").html()&&t.queueItem.find(".fileinfo").html(" - Cancelled"),t.queueItem.find(".progress-bar").width(0),t.queueItem.delay(n).fadeOut(o,function(){e(this).remove()}),delete t.queueItem,u.queue.count--)},u.filesToUpload=function(){var e=0;for(var t in u.inputs){input=u.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)file=input.files[i],file.skip||file.complete||e++}return e},u.checkExists=function(i){if(e.inArray("onCheck",r.overrideEvents)<0){e.ajaxSetup({async:!1});var n=e.extend(r.formData,{filename:i.name});if(e.post(r.checkScript,n,function(e){i.exists=parseInt(e)}),i.exists&&!confirm("A file named "+i.name+" already exists in the upload folder.\nWould you like to replace it?"))return t.cancel.call(o,i),!0}return"function"==typeof r.onCheck&&r.onCheck.call(o,i,i.exists),!1},u.uploadFile=function(t,n){if(!t.skip&&!t.complete&&!t.uploading)if(t.uploading=!0,u.uploads.current++,u.uploads.attempted++,xhr=t.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"==typeof FormData){var l=new FormData;l.append(r.fileObjName,t);for(i in r.formData)l.append(i,r.formData[i]);xhr.open(r.method,r.uploadScript,!0),xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&u.progress(e,t)},!1),xhr.addEventListener("load",function(e){4==this.readyState&&(t.uploading=!1,200==this.status?1==t.xhr.responseText?u.uploadComplete(e,t,n):u.error(t.xhr.responseText,t,n):404==this.status?u.error("404_FILE_NOT_FOUND",t,n):403==this.status?u.error("403_FORBIDDEN",t,n):u.error("Unknown Error",t,n))}),xhr.send(l)}else{var a=new FileReader;a.onload=function(i){var l="-------------------------"+(new Date).getTime(),a="--",s="\r\n",p="";p+=a+l+s,p+='Content-Disposition: form-data; name="'+r.fileObjName+'"',t.name&&(p+='; filename="'+t.name+'"'),p+=s,p+="Content-Type: application/octet-stream"+s+s,p+=i.target.result+s;for(key in r.formData)p+=a+l+s,p+='Content-Disposition: form-data; name="'+key+'"'+s+s,p+=r.formData[key]+s;p+=a+l+a+s,xhr.upload.addEventListener("progress",function(e){u.progress(e,t)},!1),xhr.addEventListener("load",function(e){t.uploading=!1;var i=this.status;404==i?u.error("404_FILE_NOT_FOUND",t,n):"Invalid file type."!=t.xhr.responseText?u.uploadComplete(e,t,n):u.error(t.xhr.responseText,t,n)},!1);var d=r.uploadScript;if("get"==r.method){var f=e(r.formData).param();d+=f}xhr.open(r.method,r.uploadScript,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+l),"function"==typeof r.onUploadFile&&r.onUploadFile.call(o,t),xhr.sendAsBinary(p)},a.readAsBinaryString(t)}},u.progress=function(t,i){if(e.inArray("onProgress",r.overrideEvents)<0){if(t.lengthComputable)var n=Math.round(t.loaded/t.total*100);i.queueItem.find(".fileinfo").html(" - "+n+"%"),i.queueItem.find(".progress-bar").css("width",n+"%")}"function"==typeof r.onProgress&&r.onProgress.call(o,i,t)},u.error=function(i,n,l){e.inArray("onError",r.overrideEvents)<0&&(errorMsg='<span style="color:#d00;">'+i+"</span>",n.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),n.queueItem.find(".progress").remove()),"function"==typeof r.onError&&r.onError.call(o,i,n),n.skip=!0,"404_FILE_NOT_FOUND"==i?u.uploads.errors++:u.queue.errors++,l&&t.upload.call(o,null,!0)},u.uploadComplete=function(i,n,l){e.inArray("onUploadComplete",r.overrideEvents)<0&&(n.queueItem.find(".progress-bar").css("width","100%"),n.queueItem.find(".fileinfo").html(' - <span style="color:#008000;">Completed</span>'),n.queueItem.find(".progress").slideUp(250),n.queueItem.addClass("complete")),"function"==typeof r.onUploadComplete&&r.onUploadComplete.call(o,n,n.xhr.responseText),r.removeCompleted&&setTimeout(function(){t.cancel.call(o,n)},3e3),n.complete=!0,u.uploads.successful++,u.uploads.count++,u.uploads.current--,delete n.xhr,l&&t.upload.call(o,null,!0)},u.queueComplete=function(){"function"==typeof r.onQueueComplete&&r.onQueueComplete.call(o,u.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof r.onFallback&&r.onFallback.call(o),!1;if(r.id="uploadifive-"+o.attr("id"),u.button=e("#uploadifive"),r.buttonClass&&u.button.addClass(r.buttonClass),u.button.css({overflow:"hidden",position:"relative"}),o.before(u.button).appendTo(u.button).hide(),u.createInput.call(o),r.queueID?u.queueEl=e("#"+r.queueID):(r.queueID=r.id+"-queue",u.queueEl=e('<div id="'+r.queueID+'" class="uploadifive-queue" />'),u.button.after(u.queueEl)),r.dnd){var a=r.dropTarget?e(r.dropTarget):u.queueEl.get(0);a.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),a.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),a.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),a.addEventListener("drop",u.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);this.send(n.buffer)}),"function"==typeof r.onInit&&r.onInit.call(o)})},debug:function(){return this.each(function(){console.log(e(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var n=e(this),o=n.data("uploadifive"),u=o.settings;for(var r in o.inputs)for(input=o.inputs[r],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],t.cancel.call(n,file);"function"==typeof u.onClearQueue&&u.onClearQueue.call(n,e("#"+o.settings.queueID))})},cancel:function(i,n){this.each(function(){var o=e(this),u=o.data("uploadifive"),r=u.settings;"string"==typeof i&&(isNaN(i)||(fileID="uploadifive-"+e(this).attr("id")+"-file-"+i),i=e("#"+fileID).data("file")),i.skip=!0,u.filesCancelled++,i.uploading&&(u.uploads.current--,i.uploading=!1,i.xhr.abort(),delete i.xhr,t.upload.call(o)),e.inArray("onCancel",r.overrideEvents)<0&&u.removeQueueItem(i,n),"function"==typeof r.onCancel&&r.onCancel.call(o,i)})},upload:function(t,i){this.each(function(){var n=e(this),o=n.data("uploadifive"),u=o.settings;if(t)o.uploadFile.call(n,t);else if(o.uploads.count+o.uploads.current<u.uploadLimit||0==u.uploadLimit){if(!i){o.uploads.attempted=0,o.uploads.successsful=0,o.uploads.errors=0;var r=o.filesToUpload();"function"==typeof u.onUpload&&u.onUpload.call(n,r)}e("#"+u.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){return _file=e(this).data("file"),o.uploads.current>=u.simUploadLimit&&0!==u.simUploadLimit||o.uploads.current>=u.uploadLimit&&0!==u.uploadLimit||o.uploads.count>=u.uploadLimit&&0!==u.uploadLimit?!1:void(u.checkScript?(_file.checking=!0,skipFile=o.checkExists(_file),_file.checking=!1,skipFile||o.uploadFile(_file,!0)):o.uploadFile(_file,!0))}),0==e("#"+u.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&o.queueComplete()}else 0==o.uploads.current&&(e.inArray("onError",u.overrideEvents)<0&&o.filesToUpload()>0&&0!=u.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof u.onError&&u.onError.call(n,"UPLOAD_LIMIT_EXCEEDED",o.filesToUpload()))})},destroy:function(){this.each(function(){var i=e(this),n=i.data("uploadifive"),o=n.settings;t.clearQueue.call(i),o.queueID||e("#"+o.queueID).remove(),i.siblings("input").remove(),i.show().insertBefore(n.button),n.button.remove(),"function"==typeof o.onDestroy&&o.onDestroy.call(i)})}};e.fn.uploadifive=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("The method "+i+" does not exist in $.uploadify"):t.init.apply(this,arguments)}}(jQuery);